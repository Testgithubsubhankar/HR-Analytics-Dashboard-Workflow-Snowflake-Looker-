

--Data Cleaning and Transformation

DELETE FROM PRODUCTION_STAFF
WHERE employee_name IS NULL;


ALTER TABLE HR_DATASET DROP COLUMN EMPLOYEE_NAME;
ALTER TABLE HR_DATASET DROP COLUMN POSITION;
ALTER TABLE PRODUCTION_STAFF DROP COLUMN POSITION;


CREATE OR REPLACE TABLE EMPLOYEE_BRIDGE AS
SELECT DISTINCT
  EMPLOYEE_NUMBER,
  EMPLOYEE_NAME
FROM CORE_DATASET
WHERE EMPLOYEE_NUMBER IS NOT NULL AND EMPLOYEE_NAME IS NOT NULL;


CREATE OR REPLACE TABLE prod_with_id AS 
SELECT 
  p.*,               
  b.EMPLOYEE_NUMBER      
FROM PRODUCTION_STAFF p
LEFT JOIN EMPLOYEE_BRIDGE b
  ON LOWER(TRIM(p.employee_name)) = LOWER(TRIM(b.employee_name));

  
-- Data Modelling

CREATE OR REPLACE TABLE HR_FULL_VIEW AS
Select 
C.EMPLOYEE_NUMBER,
C.EMPLOYMENT_STATUS,
C.DEPARTMENT,
C.DATE_OF_HIRE,
C.DATE_OF_TERMINATION,
C.REASON_FOR_TERM,
H.DAYS_EMPLOYED,
C.AGE,
C.SEX,
C.RACEDESC,
C.MARITALDESC,
C.CITIZENDESC,
C.PAY_RATE,
E.POSITION,
E.SALARY_MIN, E.SALARY_MID, E.SALARY_MAX,
C.PERFORMANCE_SCORE,
C.EMPLOYEE_SOURCE,
R.JANUARY, R.FEBRUARY,R.MARCH, R.APRIL , R.MAY , R.JUNE, R.JULY, R.AUGUST,R.SEPTEMBER,R.OCTOBER,R.NOVEMBER,R.DECEMBER,
R.TOTAL
from CORE_DATASET c 
left join HR_DATASET h on c.employee_number = h.employee_number
left join prod_with_id p on c.employee_number = p.employee_number
left join RECRUITING_COST R on c.employee_source = R.EMPLOYMENT_SOURCE
left join SALARY_GRID_CLEANED E on c.position = E.position;


DELETE FROM HR_FULL_VIEW
WHERE employee_number IS NULL;



ALTER TABLE HR_FULL_VIEW ADD COLUMN EMPLOYMENT_STATUS_SIMPLIFIED STRING;


UPDATE HR_FULL_VIEW
SET EMPLOYMENT_STATUS_SIMPLIFIED = 
    CASE 
        WHEN EMPLOYMENT_STATUS = 'Active' THEN 'Active'
        ELSE 'Terminated'
    END;



SELECT SEX FROM HR_FULL_VIEW;





